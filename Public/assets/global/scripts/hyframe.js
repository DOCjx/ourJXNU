var HyFrame=function(){var e;$.extend({url:function(e,t){if(t=t||location.href,!e)return t;if("?"===e.charAt(0)||"#"===e.charAt(0)){var n={},a=e.split(e.charAt(0))[1],i="?"===e.charAt(0)?/.+\?([^#]+).*/:/.+#(.+)/;if(query=t.replace(i,"$1"),query)for(var s,r=query.split("&"),o=0,c=r.length;o<c;o++)s=r[o].split("="),n[s[0]]=s[1];return a?n[a]||"":n}var l=arguments[1]?t.match(/([^\/]*\/\/:)?([^(\/\?#)]*)(\/?[^(\?#)]*)\??([^#]*)#?(.*)/):window.location;switch(e){case"parse":if(arguments[1]){var u=l[1]&&l[2].split(":")||{};return{host:u[0],port:u[1],path:l[1]?l[3]:l[2]+l[3],query:l[4],fragment:l[5]}}return{host:l.hostname,port:l.port,path:l.pathname,query:l.search.replace(/^\?/,""),fragment:l.hash.replace(/^#/,"")};case"domain":var d=l.hostname||l[1].split(":")[0];if(/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/.test(d))return d;var h=d.split(".");return h.length>2&&h.shift(),h.join(".")}},U:function(e,t){var e=$.url("parse",e),n="";if(e.path){var a=e.path.split("/");switch(a.length){case 3:n=_INDEX_;break;case 2:n=_MODULE_;break;case 1:n=_CONTROLLER_}n+="/"+e.path}else n=_ACTION_;var i=function(e,t){return t?e.indexOf("?")>-1?e+"&"+t:e+"?"+t:e};if(!t)return i(n,e.query)+(e.fragment?"#"+e.fragment:"");var s=[];for(var r in t)s.push(r+"="+(t[r]||""));return i(i(n,e.query),s.join("&"))+(e.fragment?"#"+e.fragment:"")},log:function(){if(window.console)return arguments.length>1&&(arguments[0]+=" => "),console.log.apply(console,arguments)},date:function(e,t){var n=t?new Date(t):new Date;return e.replace(/[YmdHisx]/g,function(e){switch(e){case"Y":return n.getFullYear();case"m":return n.getMonth()+1;case"d":return n.getDate();case"H":return n.getHours();case"i":return n.getMinutes();case"s":return n.getSeconds();case"x":switch(n.getDay()){case 0:return"星期日";case 1:return"星期一";case 2:return"星期二";case 3:return"星期三";case 4:return"星期四";case 5:return"星期五";case 6:return"星期六"}}})},count:function(e){if("string"==typeof e||$.isArray(e))return e.length;if($.isPlainObject(e)){var t=0;for(var n in e)t++;return t}},ucfirst:function(e){return e.replace(/(^|\s+)\w/g,function(e){return e.toUpperCase()})},speak:function(e,t,n){return"speechSynthesis"in window&&(!e||(n&&n(),$.utterance&&window.speechSynthesis.cancel(),$.utterance=new SpeechSynthesisUtterance,$.utterance.lang="zh-CN",$.utterance.finished=!1,$.utterance.onend=function(e){$.utterance.finished=!0,t&&t()},$.utterance.text=e,void window.speechSynthesis.speak($.utterance)))},loading:function(e,t){Metronic.blockUI({message:t||"正在载入...",target:e,cenrerY:!0,boxed:!0})},unloading:function(e){Metronic.unblockUI(e)},confirm:function(e,t,n){bootbox.dialog({message:e,title:'<h4 class="caption"><i class="fa fa-warning font-green-sharp fa-fw"></i><span class="caption-subject font-green-sharp bold">确认操作</span></h4>',buttons:{confirm:{label:"继续",className:"blue",callback:function(){$.isFunction(t)&&t()}},cancel:{label:"取消",className:"default",callback:function(){$.isFunction(n)&&n()}}}})},actionAlert:function(e,t,n){return Metronic.alert({type:e.status?"success":"warning",icon:e.status?"check":"warning",message:e.info,container:"#hy-alert-wrapper",place:"append",closeInSeconds:t?0:5}),e.reload?location.reload():($.isFunction(n)&&n(e),!1)},store:store,isPhone:$(window).width()<480}),"undefined"!=typeof echarts&&($.fn.echarts=function(e){if($.isPlainObject(arguments[0])){var t=echarts.init(this[0]),n=!1;return $(this).data("_echarts",n=t.setOption(arguments[0])),n}var n=$(this).data("_echarts");if("string"==typeof arguments[0]){var a=[];for(var i in arguments)a.push(arguments[i]);return n&&n[arguments[0]].apply(n,a.shift)}if(0===arguments.length)return n}),"undefined"!=typeof bootbox&&bootbox.setDefaults("locale","zh_CN"),$.fn.datetimepicker&&($.fn.datetimepicker.dates["zh-CN"]={days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六","星期日"],daysShort:["周日","周一","周二","周三","周四","周五","周六","周日"],daysMin:["日","一","二","三","四","五","六","日"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],today:"今日",suffix:[],meridiem:["上午","下午"]}),$.fn.selectpicker&&($.fn.selectpicker.defaults={noneSelectedText:"请选择...",noneResultsText:"没有找到匹配项",countSelectedText:"选中{1}中的{0}项",maxOptionsText:["超出限制 (最多选择{n}项)","组选择超出限制(最多选择{n}组)"],multipleSeparator:", "}),$.fn.select2&&($.fn.select2.locales["zh-CN"]={formatNoMatches:function(){return"没有找到匹配项"},formatInputTooShort:function(e,t){var n=t-e.length;return"请再输入"+n+"个字符"},formatInputTooLong:function(e,t){var n=e.length-t;return"请删掉"+n+"个字符"},formatSelectionTooBig:function(e){return"你只能选择最多"+e+"项"},formatLoadMore:function(e){return"加载结果中…"},formatSearching:function(){return"搜索中…"}},$.extend($.fn.select2.defaults,$.fn.select2.locales["zh-CN"])),$().validate&&($.extend($.validator.messages,{required:"必须填写",remote:"请修正此栏位",email:"请输入有效的电子邮件",url:"请输入有效的网址",date:"请输入有效的日期",dateISO:"请输入有效的日期 (YYYY-MM-DD)",number:"请输入正确的数字",digits:"只可输入数字",creditcard:"请输入有效的信用卡号码",equalTo:"你的输入不相同",extension:"请输入有效的后缀",maxlength:$.validator.format("最多 {0} 个字"),minlength:$.validator.format("最少 {0} 个字"),rangelength:$.validator.format("请输入长度为 {0} 至 {1} 之間的字串"),range:$.validator.format("请输入 {0} 至 {1} 之间的数值"),max:$.validator.format("请输入不大于 {0} 的数值"),min:$.validator.format("请输入不小于 {0} 的数值")}),$.validator.addMethod("regex",function(e,t,n){var a=new RegExp(n);return this.optional(t)||a.test(e)},"格式不正确！"),$.validator.addMethod("phone",function(e,t){return this.optional(t)||/^1[3578]d{9}$/.test(e)},"请输入正确的手机号！")),$(".hy-refresh").click(function(e){e.preventDefault(),location.reload()}),$(".hy-history").click(function(e){e.preventDefault(),history.go(-1)});var t=function(){var e,t,n=$.store.get("_homyit_token_seed_"),a=1,i=$.U("System/HyStart/online"),s=function(){t="#Homyit"+a++ +"#Keep#Try#"+Math.floor(1e7*Math.random()),$.get(i,{keepTry:crypto_aes(t,n)},function(t){t.status||clearInterval(e)})};e=setInterval(s,6e5)},n=function(){var e=$.store.get("_homyit_token_seed_");if(!e)return bootbox.alert('<h3 class="text-danger">为了最大限度保证您的信息安全，网站访问期间，请勿清空缓存或切换浏览器模式。现在我们需要再次对您进行身份认证，请重新登录后继续！</h3>',function(){location.href=$.U("System/HyStart/login")});var t=$.store.get("_homyit_token_counter_")+1;$.store.set("_homyit_token_counter_",t);var n="#Homyit"+t+"#Base#Auth#"+Math.floor(1e7*Math.random()),a=crypto_aes(n,e);$.cookieStorage.set("_homyit_token_",a)};return e={init:function(){t()},advanced:function(){n()},initMenu:function(e){if(e&&!$.isEmptyObject(e)){$("#hy-sidebar-menu").empty();var t="";$.each(e||{},function(e,n){t+="<li"+(n.first?' class="start"':"")+">",t+=(n.name?'<a href="'+n.name+'" class="hy-menu-trace" ':'<a  href="javascript:;" ')+' data-menu-first="'+e+'">',t+='<i class="'+(n.options?n.options:"")+'"></i><span class="title">'+n.title+"</span>",n.children?(t+='<span class="is-selected"></span><span class="arrow"></span></a><ul class="sub-menu">',$.each(n.children,function(n,a){t+="<li>"+(a.title?'<a href="'+a.name+'" class="hy-menu-trace" data-menu-pid="'+e+'" data-menu-second="'+n+'">':'<a  href="javascript:;">')+'<i class="'+(a.options?a.options:"")+'"></i>&nbsp;<span>'+a.title+"</span></a></li>"}),t+="</ul>"):t+="</a>",t+="</li>"}),$.store.set("HomyitStuSys_menuDom",t),$("#hy-sidebar-menu").html(t),$("#hy-sidebar-menu > li.start").addClass("active")}else{var n=$.store.get("HomyitStuSys_menuDom");if(!n)return location.href=$("System/Index/index");var a=($.store.get("HomyitStuSys_menuFirst")||{}).index,i=($.store.get("HomyitStuSys_menuSecond")||{}).index;$("#hy-sidebar-menu").html(n);var s=$('#hy-sidebar-menu > li > [data-menu-first="'+a+'"]');s.find(".is-selected").addClass("selected"),s.find(".arrow").addClass("open").closest("li").addClass("active open"),$('#hy-sidebar-menu > li > .sub-menu [data-menu-second="'+i+'"]').closest("li").addClass("active")}$(".hy-menu-trace").on("click",function(){if($(this).data("menu-second")){$.store.set("HomyitStuSys_menuSecond",{index:$(this).data("menu-second"),text:$(this).find("span").html()});var e=$("[data-menu-first='"+$(this).data("menu-pid")+"']");$.store.set("HomyitStuSys_menuFirst",{index:e.data("menu-first"),text:e.find("span.title").html()})}else $(this).data("menu-first")&&($.store.set("HomyitStuSys_menuFirst",{index:$(this).data("menu-first"),text:$(this).find("span.title").html()}),$.store.remove("HomyitStuSys_menuSecond"));return!0})},initBreadcrumb:function(e){if(!e){e=[];var t=$.store.get("HomyitStuSys_menuFirst");t&&e.push({text:t.text});var n=$.store.get("HomyitStuSys_menuSecond");n&&e.push({text:n.text})}$("#hy-breadcrumb").empty();var a='<li><span class="hidden-xs">&nbsp;</span><i class="fa fa-home"></i><span class="hidden-xs">&nbsp;</span><a href="'+$.U("System/Index/index")+'" class="hy-menu-trace" data-menu-first="0">首页</a><span class="hidden-xs">&nbsp;</span><i class="fa fa-angle-right"></i>';$.each(e,function(t,n){a+='<li><span class="hidden-xs">&nbsp;</span>'+(n.icon?'<i class="'+n.icon+'"></i><span class="hidden-xs">&nbsp;</span>':""),a+='<a href="'+(n.url?n.url:"javascript:;")+'">'+n.text+'</a><span class="hidden-xs">&nbsp;</span>',a+=t+1==e.length?"":'<i class="fa fa-angle-right"></i>'}),$("#hy-breadcrumb").html(a)},uploadHandler:function(){return!!$(".hy-upload").size()&&void $(".hy-upload").each(function(){var e=$(this);e.fileapi({url:$.U("System/HyFile/upload"),accept:e.find('[name="filedata"]').attr("accept"),multiple:!1,maxFiles:1,elements:{ctrl:{upload:".js-upload"},empty:{show:".b-upload__hint"},emptyQueue:{hide:".js-upload"},list:".js-files",file:{tpl:".js-file-tpl",preview:{el:".b-thumb__preview",width:80,height:80},upload:{show:".progress",hide:".b-thumb__rotate"},complete:{hide:".progress"},progress:".progress .bar"}},onSelect:function(t,n){$(".js-file-tpl",e).eq(0).remove()},onComplete:function(t,n){var a=n.widget.$el.data("field"),n=n.result;n.status||$.actionAlert(n),$('[name="'+a+'"]').val(n.data.key),$(".js-browse span:first",e).html("重新上传"),$(".js-browse",e).removeClass("blue").addClass("btn-success")}}),$(this).show()})},tplRplRecursive:function(t){return t._base.replace(/\{:(\w+)}/g,function(n,a){return $.isPlainObject(t[a])?e.tplRplRecursive(t[a]):t[a]||""})},initSelect2:function(){$().select2&&!isPhone&&$(".select2s:not(.no-select2)").addClass("no-select2").select2({placeholder:"请选择...",allowClear:!0})},initBsSelect:function(){if($().selectpicker){var e;$(".bs-selects:not(.no-bs-select)").each(function(){e=!1!==$(this).data("search"),$(this).selectpicker({iconBase:"fa",tickIcon:"fa-check",size:6,liveSearch:e,selectedTextFormat:"count > 3",mobile:HyFrame.isPhone&&!e})})}},initDatetimePicker:function(){if($().datetimepicker){var e={fontAwesome:!0,language:"zh-CN",weekStart:0,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,forceParse:0},t=$("input.datepickers:not(.datetimepickers)");if(t.size()){var n,a;t.each(function(){n=$(this).data("date-format")?$(this).data("date-format"):"yyyy-mm-dd",a=/dd/.test(n),$(this).datetimepicker($.extend({},e,{format:n,startView:a?2:3,minView:a?2:3}))})}var i=$("input.datetimepickers");i.size()&&i.each(function(){$(this).datetimepicker($.extend({},e,{format:$(this).data("date-format")?$(this).data("date-format"):"yyyy-mm-dd hh:ii",showMeridian:1}))}),$(".input-daterange .datepickers").click(function(){var e=$(this),t=e.index(".input-daterange .datepickers"),n=e.parents(".input-daterange").find(".datepickers").eq(t?0:1).val();n&&e.datetimepicker(t?"setStartDate":"setEndDate",n)})}},initSlimScroll:function(){$.isPhone&&$(".scroller.no-scroller-xs").removeClass("scroller").css({height:"auto"})},initAJAX:function(){e.initSelect2(),e.initDatetimePicker(),e.initBsSelect(),e.initSlimScroll(),Metronic.initAjax()}}}();